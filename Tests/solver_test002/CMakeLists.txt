project(solver_test002)
set(SOURCE main.cpp)

add_executable(solver_test002 ${SOURCE})

target_link_libraries(solver_test002 inmost)

if(USE_MPI)
	message("linking solver_test002 with MPI")
	target_link_libraries(solver_test002 ${MPI_LIBRARIES}) 
  if(MPI_LINK_FLAGS)
	  set_target_properties(solver_test002 PROPERTIES LINK_FLAGS "${MPI_LINK_FLAGS}")
  endif() 
endif(USE_MPI)

if(USE_ZLIB)
  message("linking solver_test002 with ZLIB")
  target_link_libraries(solver_test002 ${ZLIB_LIBRARIES}) 
endif(USE_ZLIB)

if(USE_SOLVER)
  if(USE_SOLVER_ANI)
	  message("linking solver_test002 with ani3d and BLAS")
	  target_link_libraries(solver_test002 ani3d ${BLAS_LIBRARIES})
    if(BLAS_LINKER_FLAGS)
	    set_target_properties(solver_test002 PROPERTIES LINK_FLAGS "${BLAS_LINKER_FLAGS}")
    endif()
  endif()
  if(USE_SOLVER_PETSC)
	  message("linking solver_test002 with PETSc")
	  target_link_libraries(solver_test002 ${PETSC_LIBRARIES})
  endif()
  if(USE_SOLVER_TRILINOS)
	  message("linking solver_test002 with Trilinos")
	  target_link_libraries(solver_test002 ${Trilinos_LIBRARIES} ${Trilinos_TPL_LIBRARIES})
  endif()
  if(USE_SOLVER_METIS)
    message("linking solver_test002 with Metis")
    target_link_libraries(solver_test002 ${METIS_LIBRARIES})
  endif()
  if(USE_SOLVER_MONDRIAAN)
    message("linking solver_test002 with Mondriaan")
    target_link_libraries(solver_test002 ${MONDRIAAN_LIBRARIES})
  endif()
  if(USE_SOLVER_SUPERLU)
    message("linking solver_test002 with SuperLU")
    target_link_libraries(solver_test002 ${SUPERLU_LIBRARIES})
  endif()
endif()

add_test(NAME solver_test002_serial_inner_ilu2                 COMMAND $<TARGET_FILE:solver_test002>  inner_ilu2 20)
add_test(NAME solver_test002_serial_inner_ddpqiluc               COMMAND $<TARGET_FILE:solver_test002>  inner_ddpqiluc2 20)
add_test(NAME solver_test002_serial_inner_mptiluc               COMMAND $<TARGET_FILE:solver_test002>  inner_mptiluc 20)
add_test(NAME solver_test002_serial_inner_mlmptiluc               COMMAND $<TARGET_FILE:solver_test002>  inner_mlmptiluc 20)
add_test(NAME solver_test002_serial_inner_mptilu2               COMMAND $<TARGET_FILE:solver_test002>  inner_mptilu2 20)
if(SOLVER_DEFINITIONS MATCHES "^.*HAVE_SOLVER_FCBIILU2.*$")
    add_test(NAME solver_test002_serial_fcbiilu2 COMMAND $<TARGET_FILE:solver_test002> fcbiilu2 20)
endif()

if(SOLVER_DEFINITIONS MATCHES "^.*HAVE_SOLVER_K3BIILU2.*$")
    add_test(NAME solver_test002_serial_k3biilu2 COMMAND $<TARGET_FILE:solver_test002> k3biilu2 20)
endif()

if(USE_SOLVER_TRILINOS AND USE_MPI)
add_test(NAME solver_test002_serial_trilinos_aztec             COMMAND $<TARGET_FILE:solver_test002>  trilinos_aztec 20)
add_test(NAME solver_test002_serial_trilinos_belos             COMMAND $<TARGET_FILE:solver_test002>  trilinos_belos 20)
add_test(NAME solver_test002_serial_trilinos_ml                COMMAND $<TARGET_FILE:solver_test002>  trilinos_ml 20)
add_test(NAME solver_test002_serial_trilinos_ifpack            COMMAND $<TARGET_FILE:solver_test002>  trilinos_ifpack 20)
endif()

if(USE_SOLVER_PETSC)
add_test(NAME solver_test002_serial_petsc                      COMMAND $<TARGET_FILE:solver_test002>  petsc 20)
endif()


if(USE_SOLVER_ANI)
add_test(NAME solver_test002_serial_ani COMMAND $<TARGET_FILE:solver_test002>  ani 20)
endif()

if( USE_MPI )
if( EXISTS ${MPIEXEC} )
add_test(NAME solver_test002_parallel_inner_ilu2        COMMAND ${MPIEXEC} -np 4 $<TARGET_FILE:solver_test002>  inner_ilu2 20)
add_test(NAME solver_test002_parallel_inner_ddpqiluc      COMMAND ${MPIEXEC} -np 4 $<TARGET_FILE:solver_test002>  inner_ddpqiluc2 20)
add_test(NAME solver_test002_parallel_inner_mptiluc      COMMAND ${MPIEXEC} -np 4 $<TARGET_FILE:solver_test002>  inner_mptiluc 20)
add_test(NAME solver_test002_parallel_inner_mlmptiluc      COMMAND ${MPIEXEC} -np 4 $<TARGET_FILE:solver_test002>  inner_mlmptiluc 20)
add_test(NAME solver_test002_parallel_inner_mptilu2      COMMAND ${MPIEXEC} -np 4 $<TARGET_FILE:solver_test002>  inner_mptilu2 20)

if(USE_SOLVER_TRILINOS)
add_test(NAME solver_test002_parallel_trilinos_aztec    COMMAND ${MPIEXEC} -np 4 $<TARGET_FILE:solver_test002>  trilinos_aztec 20)
add_test(NAME solver_test002_parallel_trilinos_belos    COMMAND ${MPIEXEC} -np 4 $<TARGET_FILE:solver_test002>  trilinos_belos 20)
add_test(NAME solver_test002_parallel_trilinos_ml       COMMAND ${MPIEXEC} -np 4 $<TARGET_FILE:solver_test002>  trilinos_ml 20)
add_test(NAME solver_test002_parallel_trilinos_ifpack   COMMAND ${MPIEXEC} -np 4 $<TARGET_FILE:solver_test002>  trilinos_ifpack 20)
endif()


if(USE_SOLVER_PETSC)
add_test(NAME solver_test002_parallel_petsc             COMMAND ${MPIEXEC} -np 4 $<TARGET_FILE:solver_test002>  petsc 20)
endif()

if(SOLVER_DEFINITIONS MATCHES "^.*HAVE_SOLVER_FCBIILU2.*$")
    add_test(NAME solver_test002_parallel_fcbiilu2 COMMAND $<TARGET_FILE:solver_test002> fcbiilu2 20)
endif()

if(SOLVER_DEFINITIONS MATCHES "^.*HAVE_SOLVER_K3BIILU2.*$")
    add_test(NAME solver_test002_parallel_k3biilu2 COMMAND $<TARGET_FILE:solver_test002> k3biilu2 20)
endif()

endif()
endif()
